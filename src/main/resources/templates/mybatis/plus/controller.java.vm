package ${package.Controller};

import org.apache.logging.log4j.LogManager;
import ${package.Parent}.common.ResponseEntity;
import ${package.Parent}.bean.param.CommonParam;
import ${package.Entity}.enums.StatusEnum;
import ${package.Entity}.${entity}Entity;
import ${package.Service}.${table.serviceName};
        
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import com.github.pagehelper.PageInfo;

#if(${restControllerStyle})
#else
import org.springframework.stereotype.Controller;
#end
#if(${superControllerClassPackage})
import ${superControllerClassPackage};
#end

/**
 * <p>
 * $!{table.comment} 前端控制器
 * </p>
 *
 * @author ${author}
 * @since ${date}
 */
#if(${restControllerStyle})
@RestController
#else
@Controller
#end
@RequestMapping("{tenantCode}/#if(${package.ModuleName})/${package.ModuleName}s#end#if(${controllerMappingHyphenStyle})${controllerMappingHyphen}s#else${table.entityPath}s#end")
#if(${superControllerClass})
public class ${table.controllerName} extends ${superControllerClass} {
#else
public class ${table.controllerName} {
#end
    @Autowired
    private ${table.serviceName} ${serviceVariableName};

    
    /**
     * 获取分页列表
     * 
     * @param tenantCode 租户代码
     * @param commonParam
     * @return
     */
    @GetMapping("/list")
    public ResponseEntity<PageInfo<${entity}Entity>> list(@PathVariable(value = "tenantCode")  String tenantCode,CommonParam commonParam) {
        return new ResponseEntity<PageInfo<${entity}Entity>>().ok().setResponseContent(${serviceVariableName}.listPage(tenantCode,commonParam));
    }
    
    /**
     * 获取单个对象
     * 
     * @param tenantCode 租户代码
     * @param id
     * @return
     */
    @GetMapping("/get/{id}")
    public ResponseEntity<${entity}Entity> get(@PathVariable(value = "tenantCode")  String tenantCode,@PathVariable(value = "id") ${primaryKeyTypeString} id) {
        return new ResponseEntity<${entity}Entity>().ok().setResponseContent(${serviceVariableName}.selectByIdAndTenantCode(tenantCode,id));
    }

    /**
     * 保存对象
     * 
     * @param tenantCode 租户代码
     * @param ${entityVariableName}
     * @return
     */
    @PostMapping("/save")
    public ResponseEntity<Object> save(@PathVariable(value = "tenantCode")  String tenantCode,${entity}Entity ${entityVariableName}) {
        try {
            ${entityVariableName}.setTenantCode(tenantCode);
            ${entityVariableName}.setCreateUserId(userId); // 创建者
            ${entityVariableName}.setUpdateUserId(userId); // 最后修改者
	        if (!${serviceVariableName}.insert(${entityVariableName})){
	            return new ResponseEntity<Object>().badRequest("保存失败");    
	        }
            return new ResponseEntity<Object>().ok("保存成功");
        } catch (Exception e) {
            LogManager.getLogger().error(e);
            return new ResponseEntity<Object>().badRequest("保存失败");  
        }
    }

    /**
     * 更新
     * 
     * @param tenantCode 租户代码
     * @param id
     * @param ${entityVariableName}
     * @return
     */
    @PostMapping("/update/{id}")
    public ResponseEntity<Object> update(@PathVariable(value = "tenantCode")  String tenantCode,@PathVariable(value = "id") ${primaryKeyTypeString} id,
                                              ${entity}Entity ${entityVariableName}){
        try {
            ${entityVariableName}.setId(id).setTenantCode(tenantCode);
            ${entityVariableName}.setUpdateUserId(userId); // 最后修改者
	        if (!${serviceVariableName}.updateByIdAndTenantCode(${entityVariableName})){
	            return new ResponseEntity<Object>().badRequest("更新失败");    
	        }
	        return new ResponseEntity<Object>().ok("更新成功");
        } catch (Exception e) {
            LogManager.getLogger().error(e);
            return new ResponseEntity<Object>().badRequest("更新失败");  
        }
    }


    /**
     * 更新状态
     * 
     * @param tenantCode 租户代码
     * @param id
     * @param status 状态:ENABLE-可用，DISABLE-不可用，DELETE-删除
     * @return
     */
    @PostMapping("updateStatus/{id}")
    public ResponseEntity<Object> updateStatus(@PathVariable(value = "tenantCode")  String tenantCode,
            @PathVariable(value = "id") Long id, String status) {
        try {
            ${entity}Entity ${entityVariableName} = new ${entity}Entity();
            ${entityVariableName}.setId(id).setTenantCode(tenantCode).setStatus(status);
            ${entityVariableName}.setUpdateUserId(userId); // 最后修改者
            if (!${serviceVariableName}.updateByIdAndTenantCode(${entityVariableName})) {
                return new ResponseEntity<Object>().badRequest("更新失败");
            }

            return new ResponseEntity<Object>().ok("更新成功");
        } catch (Exception e) {
            LogManager.getLogger().error(e);
            return new ResponseEntity<Object>().badRequest("更新失败");
        }
    }
    
    
    /**
     * 逻辑删除
     * 
     * @param tenantCode 租户代码
     * @param id
     * @return
     */
    @PostMapping("/logicalDel/{id}")
    public ResponseEntity<Object> logicalDel(@PathVariable(value = "tenantCode")  String tenantCode,@PathVariable(value = "id") ${primaryKeyTypeString} id){
        try {
            ${entity}Entity ${entityVariableName} = new ${entity}Entity();
            ${entityVariableName}.setId(id).setTenantCode(tenantCode).setStatus(StatusEnum.DELETE.getCode());
            ${entityVariableName}.setUpdateUserId(userId); // 最后修改者
            if (!${serviceVariableName}.updateByIdAndTenantCode(${entityVariableName})) {
                return new ResponseEntity<Object>().badRequest("删除失败");
            }
	        return new ResponseEntity<Object>().ok("删除成功");
        } catch (Exception e) {
            LogManager.getLogger().error(e);
            return new ResponseEntity<Object>().badRequest("删除失败");  
        }
    }

    /**
     * 物理删除
     * 
     * @param tenantCode 租户代码
     * @param id
     * @return
     */
    @PostMapping("/physicalDel/{id}")
    public ResponseEntity<Object> physicalDel(@PathVariable(value = "tenantCode")  String tenantCode,@PathVariable(value = "id")  ${primaryKeyTypeString} id){
        try {
	        if (!${serviceVariableName}.deleteByIdAndTenantCode(tenantCode,id) ){
	            return new ResponseEntity<Object>().badRequest("删除失败");    
	        }
	        return new ResponseEntity<Object>().ok("删除成功");
        } catch (Exception e) {
            LogManager.getLogger().error(e);
            return new ResponseEntity<Object>().badRequest("删除失败");  
        }
    }

    
    
}